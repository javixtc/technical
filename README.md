# üß† Product Pricing API

Una API REST desarrollada con Spring Boot que expone informaci√≥n de precios de productos en funci√≥n de las fechas y prioridades. Est√° basada en principios de **arquitectura hexagonal** (puertos y adaptadores) y cubre la l√≥gica con pruebas automatizadas.

---

## üß† Descripci√≥n del problema
Dentro del sistema core de ecommerce de Inditex, se mantiene una base de datos que almacena los precios de los productos, que var√≠an seg√∫n la marca, el producto y el rango de fechas. La informaci√≥n relevante de la tabla PRICES incluye el identificador del producto, el rango de fechas de validez del precio, la tarifa que se aplica en ese periodo, y la prioridad en caso de solapamiento de fechas. La API debe proporcionar un punto de acceso REST para consultar los precios de los productos bas√°ndose en la fecha de consulta, el producto y la marca.

---

## üöÄ Tecnolog√≠as

La API est√° construida utilizando las siguientes tecnolog√≠as, que ofrecen ventajas espec√≠ficas para este tipo de problemas:

- Java 21: Lenguaje de programaci√≥n de √∫ltima generaci√≥n, utilizado para aprovechar nuevas caracter√≠sticas del lenguaje y la JVM para mejorar el rendimiento y la productividad.

- Spring Boot 3.4.3: Framework robusto y bien soportado para construir aplicaciones Java, utilizado para crear una API REST que sea f√°cil de desplegar y configurar.

- Spring Data JPA: Para interactuar con la base de datos H2 de forma eficiente, utilizando la abstracci√≥n de JPA para simplificar las consultas y el acceso a datos.

- H2: Base de datos en memoria que permite realizar pruebas r√°pidas y manejar datos de ejemplo de forma eficiente sin necesidad de configurar una base de datos persistente.

- Lombok: Biblioteca que reduce el boilerplate de c√≥digo en Java, como getters, setters y constructores, lo que mejora la legibilidad del c√≥digo.

- OpenAPI: Utilizado para documentar y generar especificaciones de la API, lo que facilita la integraci√≥n con otros servicios y herramientas.

- MapStruct: Herramienta para la conversi√≥n eficiente entre objetos, utilizada para mapear entre las entidades JPA y los DTOs.

- JUnit 5 + Mockito: Frameworks para realizar pruebas unitarias e integrar la l√≥gica del sistema con simulaciones de dependencias, asegurando el correcto funcionamiento de la API.

- Maven: Herramienta de construcci√≥n que facilita la gesti√≥n de dependencias y la construcci√≥n de la aplicaci√≥n.

---

## üß± Arquitectura

La arquitectura de este proyecto sigue los principios de **Clean Architecture**, donde las diferentes preocupaciones est√°n separadas en capas bien definidas, lo que facilita la mantenibilidad, escalabilidad y facilidad de pruebas.

### Capa de Aplicaci√≥n (application)

**Prop√≥sito**: Contiene la l√≥gica de negocio y los casos de uso espec√≠ficos de la aplicaci√≥n. Aqu√≠ se implementan los servicios y las reglas de negocio.

**Componentes**:
- **FindProductPricingUseCase.java**: Caso de uso principal de la aplicaci√≥n que implementa la l√≥gica para obtener los precios de los productos seg√∫n diferentes condiciones, como la fecha y la identificaci√≥n del producto y la marca.

### Capa de Dominio (domain)

**Prop√≥sito**: Contiene las entidades y los contratos esenciales para la l√≥gica de negocio. Aqu√≠ no se encuentra ning√∫n detalle de implementaci√≥n sobre c√≥mo se realiza el almacenamiento o la interfaz con el mundo exterior.

**Componentes**:
- **exceptions**: Define excepciones personalizadas como `PriceNotFoundException.java` para manejar errores espec√≠ficos de la l√≥gica de negocio.
- **model**: Aqu√≠ se encuentra la clase `ProductPricing.java`, que representa el modelo de datos que contiene la informaci√≥n del precio de un producto.
- **ports**: Define los puertos de entrada y salida para interactuar con la capa de infraestructura. En este caso:
    - **ProductPricingRepositoryPort.java**: Puerto para acceder a la persistencia de los datos relacionados con el precio de los productos.
    - **ProductPricingServicePort.java**: Puerto que define los servicios necesarios para la gesti√≥n de precios de productos en la l√≥gica de negocio.

### Capa de Infraestructura (infrastructure)

**Prop√≥sito**: Contiene las implementaciones t√©cnicas de la infraestructura, como el acceso a bases de datos, la configuraci√≥n de los controladores REST, y la manipulaci√≥n de datos.

**Componentes**:
- **dto**: Contiene los DTOs (Data Transfer Objects) que se utilizan para estructurar las respuestas y errores de las APIs.
    - **ErrorResponse.java**: DTO para manejar las respuestas de error en las APIs.
    - **ProductPricingResponse.java**: DTO que estructura la respuesta que se env√≠a al cliente con la informaci√≥n de los precios de productos.
- **exceptions**: Contiene el manejador global de excepciones, `GlobalExceptionHandler.java`, que maneja las excepciones globales en la aplicaci√≥n.
- **input/rest**: Contiene los controladores REST que gestionan las solicitudes HTTP.
    - **ProductPricingController.java**: Controlador que expone la API para consultar los precios de los productos y maneja las solicitudes entrantes.
- **mapper**: Contiene la l√≥gica para convertir las entidades de dominio en DTOs y viceversa.
    - **ProductPricingMapper.java**: Mapper que convierte entre las entidades de dominio, DTOs y entidades de base de datos. Los m√©todos en este mapper se refactorizan para hacerlos m√°s claros y comprensibles:
        - `toDomainFromDto(ProductPricingResponse dto)`: Convierte un DTO (`ProductPricingResponse`) a la entidad de dominio (`ProductPricing`).
        - `toDtoFromDomain(ProductPricing domain)`: Convierte una entidad de dominio (`ProductPricing`) a un DTO (`ProductPricingResponse`).
        - `toDomainFromEntity(ProductPricingEntity entity)`: Convierte una entidad de base de datos (`ProductPricingEntity`) a la entidad de dominio (`ProductPricing`).
        - `toEntityFromDomain(ProductPricing domain)`: Convierte una entidad de dominio (`ProductPricing`) a una entidad de base de datos (`ProductPricingEntity`).
- **output/persistence**: Implementa los adaptadores para interactuar con la base de datos o cualquier otra fuente de datos.
    - **ProductPricingEntity.java**: Representaci√≥n de los precios de productos en la base de datos utilizando JPA.
    - **ProductPricingJpaRepository.java**: Repositorio de Spring Data JPA para interactuar con la base de datos.
    - **ProductPricingRepositoryAdapter.java**: Adaptador que implementa el puerto de repositorio, usando el repositorio JPA para acceder a los datos.

### Capa de Configuraci√≥n

**Prop√≥sito**: Define la configuraci√≥n de la aplicaci√≥n, como las conexiones a la base de datos y otros servicios externos.

**Componentes**:
- **TechnicalApplication.java**: La clase principal que configura y arranca la aplicaci√≥n Spring Boot.
- **application.yml**: Archivo de configuraci√≥n para la aplicaci√≥n (por ejemplo, configuraci√≥n de base de datos, puertos, perfiles de Spring, etc.).

### Capa de Pruebas (test)

**Prop√≥sito**: Contiene las pruebas unitarias e integraci√≥n de cada componente del sistema.

**Componentes**:
- **application/usecase**: Contiene pruebas de la l√≥gica de negocio.
    - **FindProductPricingUseCaseTest.java**: Prueba unitaria del caso de uso de precios de productos.
- **infrastructure/input/rest**: Contiene pruebas de integraci√≥n para los controladores REST.
    - **ProductPricingControllerTest.java**: Pruebas de integraci√≥n del controlador REST que maneja las solicitudes relacionadas con los precios de los productos.
- **infrastructure/mapper**: Contiene pruebas para los mappers de entidades y DTOs.
    - **ProductPricingMapperTest.java**: Pruebas unitarias para el mapper que convierte entre las entidades y los DTOs.
- **infrastructure/output/persistence**: Contiene pruebas de integraci√≥n para los repositorios y adaptadores de persistencia.
    - **ProductPricingRepositoryAdapterTest.java**: Pruebas de integraci√≥n que verifican la correcta interacci√≥n con la base de datos usando el repositorio JPA.

---

## ‚öôÔ∏è Ejecuci√≥n

### Requisitos

- Java 21
- Maven

### ‚úÖ C√≥mo usar la API
```bash
./mvnw spring-boot:run
```

#### Pruebas navegador/postman (respuesta OK 200)
GET http://localhost:8081/api/v1/prices?date=2020-06-14T10:00:00&productId=35455&brandId=1

```json
{
  "productId": 35455,
  "brandId": 1,
  "priceList": 1,
  "startDate": "2020-06-14T00:00:00",
  "endDate": "2020-12-31T23:59:59",
  "price": 35.50,
  "currency": "EUR"
}
```

#### Open API
Acceder a http://localhost:8081/swagger-ui/index.html e introducir los valores deseados para probar:
![image](https://github.com/user-attachments/assets/28a71f96-629a-4d5c-b51f-571b9429ea39)


#### Ejecutar pruebas unitarias y de integraci√≥n:
```bash
./mvnw test
```

![image](https://github.com/user-attachments/assets/1fdf22ec-29ff-42d2-9695-dfaff31d35dd)


## Acceso a consola H2 (modo test)

- **URL**: [http://localhost:8080/h2-console](http://localhost:8080/h2-console)
- **JDBC URL**: `jdbc:h2:mem:testdb`

## üìÅ Estructura del Proyecto

```text
‚îú‚îÄ‚îÄ README.md                    # Documentaci√≥n general del proyecto
‚îú‚îÄ‚îÄ mvnw                         # Wrapper de Maven para ejecutar el proyecto
‚îú‚îÄ‚îÄ mvnw.cmd                     # Script de Windows para ejecutar el wrapper de Maven
‚îú‚îÄ‚îÄ pom.xml                      # Archivo de configuraci√≥n de Maven, contiene las dependencias y configuraciones del proyecto
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îú‚îÄ‚îÄ main
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ inditex
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ technical
‚îÇ   ‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ application
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ usecase
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ       ‚îî‚îÄ‚îÄ FindProductPricingUseCase.java     # Caso de uso que implementa la l√≥gica de negocio para encontrar los precios de productos
‚îÇ   ‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ domain
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ exceptions
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PriceNotFoundException.java        # Excepci√≥n personalizada para el caso en que no se encuentren precios de productos
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ model
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductPricing.java                # Modelo de datos que representa el precio de un producto
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ ports
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ       ‚îú‚îÄ‚îÄ ProductPricingRepositoryPort.java  # Puerto para la interacci√≥n con la persistencia de datos relacionados con el precio de productos
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ       ‚îî‚îÄ‚îÄ ProductPricingServicePort.java     # Puerto para la l√≥gica de negocio que maneja los precios de productos
‚îÇ   ‚îÇ   ‚îÇ               ‚îú‚îÄ‚îÄ infrastructure
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ dto
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ErrorResponse.java                 # DTO para estructurar la respuesta de error de la API
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductPricingResponse.java        # DTO que contiene la respuesta de precio de un producto
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ exceptions
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GlobalExceptionHandler.java        # Manejador global de excepciones para manejar errores de la aplicaci√≥n
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ input
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rest
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ProductPricingController.java  # Controlador REST que maneja las solicitudes relacionadas con los precios de productos
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îú‚îÄ‚îÄ mapper
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductPricingMapper.java          # Mapper para convertir entre las entidades de dominio y los DTOs de la API
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ   ‚îî‚îÄ‚îÄ output
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ       ‚îî‚îÄ‚îÄ persistence
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ           ‚îú‚îÄ‚îÄ ProductPricingEntity.java     # Entidad JPA que representa los precios de productos en la base de datos
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ           ‚îú‚îÄ‚îÄ ProductPricingJpaRepository.java # Repositorio de Spring Data JPA para acceder a la base de datos de precios de productos
‚îÇ   ‚îÇ   ‚îÇ               ‚îÇ           ‚îî‚îÄ‚îÄ ProductPricingRepositoryAdapter.java # Adaptador que implementa el puerto de repositorio para interactuar con el repositorio JPA
‚îÇ   ‚îÇ   ‚îÇ               ‚îî‚îÄ‚îÄ TechnicalApplication.java                   # Clase principal de la aplicaci√≥n que configura y ejecuta la aplicaci√≥n Spring Boot
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.yml     # Archivo de configuraci√≥n de Spring Boot (por ejemplo, puertos, configuraci√≥n de base de datos, etc.)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ data.sql            # Script SQL con datos iniciales para la base de datos
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ static              # Archivos est√°ticos (por ejemplo, im√°genes, CSS, JS)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ templates           # Plantillas (si se usa Thymeleaf o similar)
‚îÇ   ‚îî‚îÄ‚îÄ test
‚îÇ       ‚îî‚îÄ‚îÄ java
‚îÇ           ‚îî‚îÄ‚îÄ com
‚îÇ               ‚îî‚îÄ‚îÄ inditex
‚îÇ                   ‚îî‚îÄ‚îÄ technical
‚îÇ                       ‚îú‚îÄ‚îÄ application
‚îÇ                       ‚îÇ   ‚îî‚îÄ‚îÄ usecase
‚îÇ                       ‚îÇ       ‚îî‚îÄ‚îÄ FindProductPricingUseCaseTest.java # Pruebas unitarias para el caso de uso de precios de productos (pruebas de l√≥gica de negocio)
‚îÇ                       ‚îú‚îÄ‚îÄ infrastructure
‚îÇ                       ‚îÇ   ‚îú‚îÄ‚îÄ input
‚îÇ                       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ rest
‚îÇ                       ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ProductPricingControllerTest.java # Pruebas de integraci√≥n para el controlador REST que maneja las solicitudes de precios de productos
‚îÇ                       ‚îÇ   ‚îú‚îÄ‚îÄ mapper
‚îÇ                       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductPricingMapperTest.java       # Pruebas unitarias para el mapper de precios de productos
‚îÇ                       ‚îÇ   ‚îî‚îÄ‚îÄ output
‚îÇ                       ‚îÇ       ‚îî‚îÄ‚îÄ persistence
‚îÇ                       ‚îÇ           ‚îî‚îÄ‚îÄ ProductPricingRepositoryAdapterTest.java # Pruebas de integraci√≥n para el adaptador de repositorio de precios de productos
‚îÇ                       ‚îî‚îÄ‚îÄ TechnicalApplicationTests.java               # Pruebas unitarias generales de la aplicaci√≥n


